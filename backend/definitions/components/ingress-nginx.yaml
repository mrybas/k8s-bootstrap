# Ingress NGINX Component Definition
# Upstream Helm chart wrapper

id: ingress-nginx
name: Ingress NGINX
description: NGINX-based Ingress controller for Kubernetes
category: ingress
categoryName: Ingress
categoryDescription: Ingress controllers and load balancers
icon: "üåê"
priority: 20
docsUrl: https://kubernetes.github.io/ingress-nginx/

chartType: upstream
namespace: ingress-nginx
releaseName: ingress-nginx
createNamespace: true
timeout: 5m

# Upstream chart details
upstream:
  repository: https://kubernetes.github.io/ingress-nginx
  chartName: ingress-nginx
  version: "4.14.1"
  appVersion: "1.9.6"

# Dependencies
dependsOn:
  - namespaces

# Default values
defaultValues:
  controller:
    replicaCount: 2
    service:
      type: ClusterIP
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false
    admissionWebhooks:
      enabled: true
    config:
      use-forwarded-headers: "true"
      compute-full-forwarded-for: "true"

# JSON Schema for UI form
jsonSchema:
  type: object
  properties:
    controller:
      type: object
      title: Controller Settings
      properties:
        replicaCount:
          type: integer
          title: Replicas
          description: Number of controller replicas
          minimum: 1
          maximum: 10
          default: 2
        ingressClass:
          type: string
          title: Ingress Class
          description: Ingress class name
          default: nginx
        service:
          type: object
          title: Service
          properties:
            type:
              type: string
              title: Service Type
              enum:
                - LoadBalancer
                - NodePort
                - ClusterIP
              default: LoadBalancer
            externalTrafficPolicy:
              type: string
              title: External Traffic Policy
              enum:
                - Cluster
                - Local
              default: Local
            annotations:
              type: object
              title: Service Annotations
              description: Cloud provider specific annotations
              additionalProperties:
                type: string
        metrics:
          type: object
          title: Metrics
          properties:
            enabled:
              type: boolean
              title: Enable Metrics
              default: true
            serviceMonitor:
              type: object
              properties:
                enabled:
                  type: boolean
                  title: Create ServiceMonitor
                  default: false
        admissionWebhooks:
          type: object
          title: Admission Webhooks
          properties:
            enabled:
              type: boolean
              title: Enable Admission Webhooks
              default: true
        config:
          type: object
          title: NGINX Config
          description: Additional NGINX configuration
          additionalProperties:
            type: string
        resources:
          type: object
          title: Resources
          properties:
            requests:
              type: object
              properties:
                cpu:
                  type: string
                  default: "100m"
                memory:
                  type: string
                  default: "256Mi"
            limits:
              type: object
              properties:
                cpu:
                  type: string
                  default: "500m"
                memory:
                  type: string
                  default: "512Mi"

# UI Schema
uiSchema:
  controller:
    replicaCount:
      ui:widget: updown
    service:
      type:
        ui:widget: select
      annotations:
        ui:widget: keyvalue
        ui:collapsed: true
    config:
      ui:widget: keyvalue
      ui:collapsed: true
    resources:
      ui:collapsed: true
